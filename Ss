---
- name: Create user with specific UID and set permissions
  hosts: all
  become: yes
  tasks:
    - name: Create user with specific UID and home directory
      user:
        name: mgmtbld
        uid: 1234
        home: /home/mgmtbld
        create_home: yes
        state: present

    - name: Ensure /home/mgmtbld/tmp directory exists
      file:
        path: /home/mgmtbld/tmp
        state: directory
        owner: mgmtbld
        group: mgmtbld
        mode: '0755'

    - name: Set permissions of all files and directories inside /home/mgmtbld/tmp to 777
      find:
        paths: /home/mgmtbld/tmp
      register: files_and_directories

    - name: Change permissions to 777
      file:
        path: "{{ item.path }}"
        mode: '0777'
      loop: "{{ files_and_directories.files }}"
